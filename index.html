<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>PHP 7: The New New PHP</title>
  <meta name="author" content="Larry Garfield">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="platform-reveal/platform-theme/assets/css/styles.css" id="theme">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'platform-theme/assets/css/print/pdf.css' : 'platform-theme/assets/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>

  <script src="platform-reveal/countup.js"></script>
  <script src="platform-reveal/classer.js"></script>
  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->

  <style type="text/css">

    .reveal img.graphic {
      width: 100%;
      border-radius: 5px;
    }

    img.screenshot {
      border-radius: 5px;
      width: 800px;
    }

    ul.inline {
      margin: 0;
      padding: 0;
      list-style-type: none;
      text-align: center;
    }

    ul.inline li {
      display: inline;
    }

    p.bigdeal {
      font-size: 200%;
      color: Red;
      font-style: italic;
      text-shadow: 3px 3px 10px #990000;
    }

    .reveal pre + pre,
    .reveal p + pre,
    .reveal pre + p,
    .reveal p + p {
      margin-top: 1em;
    }

    ul.project-list {
      display: flex;
      flex-wrap: wrap;
      list-style: none;
      justify-content: space-around;
      align-items: baseline;
    }
    ul.project-list > li {
      padding: 20px;
    }
    ul.project-list > li > img {
      width: 150px;
    }

  </style>

</head>
<!-- Change body class to "dark" if you prefer a dark theme, or "light" if you'd rather have a light theme-->
<body class="light">
<div class="reveal">
  <div class="logo">
    <p>Platform.sh</p>
  </div>
  <!-- Any section element inside of this container is displayed as a slide -->
  <div class="slides">

    <section>
      <h1>PHP 7<span class="fragment">[.1]</span></h1>
      <h2>The New New PHP</h2>
      <p>
        <small>Presented by <a href="http://www.garfieldtech.com/">Larry Garfield</a> (<a href="http://twitter.com/Crell">@Crell</a>)</small>
      </p>
    </section>
    <section class="l-2up">
      <h2><a href="http://twitter.com/Crell">@Crell</a></h2>
      <div>
        <img src="assets/larry-olaf-hug.jpg" alt="Larry implements Huggable" style="width: 350px; margin: 0" />
      </div>
      <div>
        <ul style="text-wrap: none">
          <li>Director of Runtimes and Integrations, <a href="http://www.platform.sh/">Platform.sh</a></li>
          <li style="margin-top: 1em;">Drupal 8 Web Services Lead</li>
          <li style="margin-top: 1em;">Drupal Representative, <a href="http://www.php-fig.org/">PHP-FIG</a></li>
          <li style="margin-top: 1em;"><code>implements Huggable</code></li>
        </ul>
      </div>
    </section>
    <section>
      <img src="assets/php7-logo.svg" alt="PHP 7" data-credit="http://www.cowburn.info/2015/06/18/php7-logo/" />
      <aside class="notes">
        <ul>
          <li>PHP 6 snuk into PHP 5 party dressed as 5.3, hasn't been seen since</li>
        </ul>
      </aside>
    </section>
    <section>
      <section>
        <!-- return types-->
        <h1>#1</h1>
      </section>
      <section>
        <p class="bigtext"><q>Do you trust your docblock?</q></p>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
class User {
  protected $id;
  protected $address;

  public function getAddress() {
    return $this->address;
  }
}

function compute_shipping($src, User $user) {
  $dest = $user->getAddress();

  $distance = distance_between($src, $dest);

  return $distance * .5; // 50 cents/mile
}
        </code></pre>
        <aside class="notes">
          <ul>
            <li>What does getAddress() return? String? Address object?</li>
            <li>Does compute_shipping() want the same thing?</li>
          </ul>
        </aside>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
class User {
  protected $id;
  protected $address;

  /**
   * @return Address
   */
  public function getAddress() {
    return $this->address;
  }
}

function compute_shipping($src, User $user) {
  $dest = $user->getAddress();

  $distance = distance_between($src, $dest);

  return $distance * .5; // 50 cents/mile
}
        </code></pre>
        <aside class="notes">
          <ul>
            <li>We claim it's an Address, but is it?</li>
            <li>Could always be null.</li>
          </ul>
        </aside>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
class User {
  protected $id;
  protected $address;

  public function getAddress() : Address {
    return $this->address;
  }
}

function compute_shipping($src, User $user) {
  $dest = $user->getAddress();

  $distance = distance_between($src, $dest);

  return $distance * .5; // 50 cents/mile
}
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Always and ever an Address!</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Return types</h2>
        <ul>
          <li class="fragment">New in PHP 7!</li>
          <li class="fragment">Not nullable until 7.1</li>
        </ul>
        <aside class="notes">
          <ul>
            <li>Not null avoids errors</li>
          </ul>
        </aside>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
$r = new UserRepository();

print $r->findById(123)->getAddress()->getStreet() . PHP_EOL;
        </code></pre>
        <pre class="fragment font--24"><code class="text" data-trim>
          Method called on non-object
        </code></pre>
        <p style="margin-top: 1em" class="fragment">No NULL means:</p>
        <ul>
          <li class="fragment">Exception</li>
          <li class="fragment">"Empty" value object</li>
        </ul>
        <aside class="notes">
          <ul>
            <li>Now you sigh and add a dozen if statements.</li>
            <li>If typed returns, can't be null!  Blows up sooner.</li>
            <li>Solution depends on use case.</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>For Repositories etc.</h2>
        <pre class="font--24"><code class="php" data-trim>
class UserRepository {
  // ...

  public function findById($id) : User {
    if (/* can't find the user */) {
     throw new InvalidArgumentException('No such User: ' . $id);
    }
    return $user;
  }

}
        </code></pre>
        <aside class="notes">
          <ul>
            <li>The rest of the code likely won't work anyway.</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>For Value objects</h2>
        <pre class="font--24"><code class="php" data-trim>
interface AddressInterface {
  public function getStreet();
  public function getCity();
  public function getState();
  public function getZip();
}

class EmptyAddress implements AddressInterface {
  public function getStreet() { return ''; }
  public function getCity() { return ''; }
  public function getState() { return ''; }
  public function getZip() { return ''; }
}

class Address implements AddressInterface {
    // ...
}
        </code></pre>
        <aside class="notes">
          <ul>
            <li>An empty value is useful, sometimes.</li>
            <li>Very case-by-case.</li>
            <li>Still better than NULL</li>
          </ul>
        </aside>
      </section>
      <section>
        <p class="bigtext"><a href="http://www.garfieldtech.com/blog/empty-return-values">Returning false on error</a> is a<br />big 'screw you' to your users</p>
        <aside class="notes">
          <ul>
            <li>Undermines type expectations</li>
            <li>Forces callers to litter code with if-checks.</li>
            <li>User can't rely on types to avoid errors</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>But in 7.1...</h2>
        <pre class="font--24"><code class="php" data-trim>
class UserRepository {
  // ...

  public function findById($id) : ?User {
    if (/* can't find the user */) {
     return null;
    }
    return $user;
  }

}
        </code></pre>
        <p class="fragment">(Please don't)</p>
      </section>
      <section>
        <h2><code>void</code> returns</h2>
        <pre class="font--24"><code class="php" data-trim>
function return_to_sender() : void {
  // Do stuff
  // ...
  return; // Legal
  return null; // Not OK
  return 1; // Not even a little OK
}
        </code></pre>
      </section>
    </section>
    <section>
      <!-- scalar types -->
      <section>
        <h1>#2</h1>
      </section>
      <section data-transition="slide-in fade-out">
        <pre class="font--20"><code class="php" data-trim>
function compute_shipping($src, AddressInterface $dest) {
  $distance = distance_between($src, $dest);

  return $distance * .5; // 50 cents/mile
}

function distance_between(AddressInterface $src, AddressInterface $dest) {
  // ...
}

$u_address = new Address(); // ...
$user = new User(123, $u_address);

$src = new Address(); // ...
compute_shipping($src, $user->getAddress());
        </code></pre>
        <p class="fragment">What does distance_between() return?</p>
        <aside class="notes">
          <ul>
            <li>Could have made that change before, but more obvious when typed</li>
            <li>distance_between() seems to return number. int or float?</li>
          </ul>
        </aside>
      </section>
      <section data-transition="fade-in slide-out">
        <pre class="font--18"><code class="php" data-trim>
function compute_shipping(AddressInterface $src, AddressInterface $dest) : float {
  $distance = distance_between($src, $dest);

  return $distance * .5; // 50 cents/mile
}

function distance_between(AddressInterface $src, AddressInterface $dest) : int {
  // ...
}

$u_address = new Address(); // ...
$user = new User(123, $u_address);

$src = new Address(); // ...
compute_shipping($src, $user->getAddress());
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Assume whole miles. Round up, because greedy.</li>
          </ul>
        </aside>
      </section>
      <section>
        <p class="bigtext"><q>Everyone here owes<br />Andrea Faulds and Anthony Ferrara a drink</q></p>
      </section>
      <section>
        <h2>New type specs in PHP 7</h2>
        <ul class="fragment">
          <li>int</li>
          <li>float</li>
          <li>string</li>
          <li>bool</li>
        </ul>
        <aside class="notes">
          <ul>
            <li>No integer/boolean</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Full type list</h2>
        <ul>
          <li>int</li>
          <li>float</li>
          <li>string</li>
          <li>bool</li>
          <li>array</li>
          <li>callable</li>
          <li>Any class name</li>
        </ul>
        <aside class="notes">
          <ul>
            <li>All usable as parameters or returns</li>
          </ul>
        </aside>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
interface AddressInterface {
  public function getStreet();
  public function getCity();
  public function getState();
  public function getZip();
}
        </code></pre>
        <p class="fragment">Is getStreet() a string or object?</p>
        <aside class="notes">
          <ul>
            <li>Object with number, name, apartment?</li>
          </ul>
        </aside>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
interface AddressInterface {
  public function getStreet() : string;
  public function getCity() : string;
  public function getState() : string;
  public function getZip() : string;
}
        </code></pre>
        <pre class="fragment font--18"><code class="php" data-trim>
class Address implements AddressInterface {
  public function __construct(string $street, string $city, string $state, string $zip) {
    // ...
  }
  // ...
}
        </code></pre>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
$u_address = new Address('45 Hull St', 'Boston', 'MA', 02113);
$user = new User(123, $u_address);

$src = new Address('2211 N Elston Ave', 'Chicago', 'IL', 60614);
compute_shipping($src, $user->getAddress());
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Point out error. Becomes 1099 in Octal</li>
            <li>Biggest dispute in PHP scalar typing</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Strict vs Weak mode</h2>
        <p class="fragment">Weak by default</p>
        <p class="fragment">* string -> int may E_NOTICE</p>
        <aside class="notes">
          <ul>
            <li>Casts like we're used to</li>
            <li>PHP used to auto-coercing, because web</li>
            <li>Unsafe</li>
            <li>String -> int notice if non-numeric.</li>
            <li>Undermines type checking</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Strict mode</h2>
        <p>Address.php</p>
        <pre class="font--20"><code class="php" data-trim>
declare(strict_types=1);

class Address implements AddressInterface {
  public function __construct(string $street, string $city, string $state, string $zip) {
    // ...
  }
  public function getZip() : string {
    return $this->zip;
  }

  // ...
}
        </code></pre>
        <p class="fragment">Affects calls and returns <em>from</em> this file</p>
        <aside class="notes">
          <ul>
            <li>If $this->zip not a string, TypeError thrown</li>
            <li>Tooling can spot it!</li>
            <li>Does not affect constructor!</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Strict mode</h2>
        <p>setup.php</p>
        <pre class="font--24"><code class="php" data-trim>
declare(strict_types=1);

$u_address = new Address('45 Hull St', 'Boston', 'MA', 02113);
$user = new User(123, $u_address);

$src = new Address('2211 N Elston Ave', 'Chicago', 'IL', 606014);
compute_shipping($src, $user->getAddress());
        </code></pre>
        <p class="fragment">Affects calls and returns <em>from</em> this file</p>
        <aside class="notes">
          <ul>
            <li>Will throw TypeError</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Casting in strict mode</h2>
        <p>* int converts to float automatically</p>
        <aside class="notes">
          <ul>
            <li>Otherwise, (cast) or redesign</li>
            <li>Really, redesign</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Using strict types</h2>
        <p class="fragment bigtext">90% of the time</p>
        <p class="fragment bigtext">(Everywhere except Input)</p>
        <aside class="notes">
          <ul>
            <li>Catches the most bugs</li>
            <li>Pass data FROM IO to a typed function, weak, coerce</li>
            <li>Get the most type safety</li>
            <li>Drives good design; separate methods, predictable returns, etc.</li>
          </ul>
        </aside>
      </section>
      <section>
        <p class="bigtext">Also, Documentation</p>
        <aside class="notes">
          <ul>
            <li>"Good code is self-documenting"</li>
            <li>Static type or you're a hypocrite</li>
            <li>Static types can't go out of date like docblocs</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>BC Warning!</h2>
        <img src="assets/bc-caveman.jpg" align="BC Warning" data-credit="https://www.flickr.com/photos/alfer/1349385195" />
        <p class="bigtext">New reserved words!</p>
      </section>
    </section>
    <section>
      <!-- Spaceship -->
      <section>
        <h1>#3</h1>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
usort($array, function ($a, $b) {
  if ($a < $b) {
    return -1;
  }
  elseif ($a > $b) {
    return 1;
  }
  else {
    return 0;
  }
});
        </code></pre>
      </section>
      <section>
        <h1>T_SPACESHIP</h1>
        <h1 style="margin-top: 1em;"><=></h1>
      </section>
      <section data-background="assets/tie-interceptor.jpg" data-background-size="100%" data-credit="http://fractalsponge.net/?p=128">
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
usort ($array, function($a, $b) {
  return $a <=> $b;
});
        </code></pre>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
usort($people, function (Person $a, Person $b) {
  if ($a->lastName() < $b->lastName()) {
    return -1;
  }
  elseif ($a->lastName() > $b->lastName()) {
    return 1;
  }
  else {
    if ($a->firstName() < $b->firstName()) {
      return -1;
    }
    elseif ($a->firstName() > $b->firstName()) {
      return 1;
    }
    else {
      return 0;
    }
  }
});
        </code></pre>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
usort($people, function (Person $a, Person $b) {
  return $a->lastName() < $b->lastName() ? -1
    : ($a->lastName() > $b->lastName() ? 1
      : $a->firstName() < $b->firstName() ? -1
        : ($a->firstName() > $b->firstName() ? 1 : 0));
});
        </code></pre>
        <p id="fired" class="fragment" data-classer="fired" data-classer-class="bigdeal" style="margin-top: 1em;">You're Fired!</p>
      </section>
      <section>
        <pre class="font--20"><code class="php" data-trim>
usort($people, function (Person $a, Person $b) {
 return [$a->lastName(), $a->firstName()] <=> [$b->lastName(), $b->firstName()];
});
        </code></pre>
      </section>
    </section>
    <section>
      <!-- Null coalesce -->
      <section>
        <h1>#4</h1>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
$username = $username ? $username : 'Anonymous';
        </code></pre>
        <pre class="fragment font--24" style="margin-top: 1em;"><code class="php" data-trim>
$username = $username ?: 'Anonymous';
        </code></pre>
        <p class="fragment bigtext">But what if $username doesn't exist?</p>
        <pre class="fragment font--24" style="margin-top: 1em;"><code class="text" data-trim>
Notice: Undefined variable: username on line 3
        </code></pre>
      </section>
      <section>
        <pre class="font--20"><code class="php" data-trim>
$username = isset($username) && !is_null($username) ? $username : 'Anonymous';
        </code></pre>
        <p class="fragment">NULL coalesce!</p>
        <pre class="fragment font--24"><code class="php" data-trim>
$username = $username ?? 'Anonymous';
        </code></pre>
        <pre class="fragment font--20"><code class="php" data-trim>
$username = $submitted['username'] ?? $user->username() ?? 'Anonymous';
        </code></pre>
        <p class="fragment bigtext">?? checks setness, not truthiness</p>
      </section>
    </section>
    <section>
      <!-- CSPRING -->
      <section>
        <h1>#5</h1>
      </section>
      <section>
        <p class="bigtext">Cryptography is hard</p>
        <aside class="notes">
          <ul>
            <li>Need big random numbers</li>
            <li>Random isn't random in computers</li>
            <li>"Sufficiently" random</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Don't we have this already?</h2>
        <ul>
          <li class="fragment"><code>rand()</code> isn't really random</li>
          <li class="fragment"><code>mcrypt()</code> isn't really random (also unsupported)</li>
          <li class="fragment"><code>fread(fopen('/dev/urandom'), 16)</code> isn't portable</li>
          <li class="fragment">openssl is hard to use</li>
        </ul>
      </section>
      <section>
        <img src="assets/picard-riker-facepalm.jpg" alt="Picard-Riker Face Palm" />
      </section>
      <section>
        <p class="bigtext">What we want is an easy <br /><b>C</b>ryptographically <b>S</b>ecure <b>P</b>seudo-<b>R</b>andom <b>N</b>umber <b>G</b>enerator</p>
        <p class="bigtext fragment">CSPRNG!</p>
      </section>
      <section>
        <p class="bigtext">Ask and ye shall receive&hellip;</p>
       <pre class="fragment font--24"><code class="php" data-trim>
$junk = random_bytes(16);

$val = random_int(1, 100);
       </code></pre>
        <div class="fragment" style="margin-top: 1em;">
          <h3>On PHP 5?</h3>
          <p><code>composer require paragonie/random_compat</code></p>
          <a href="https://github.com/paragonie/random_compat">https://github.com/paragonie/random_compat</a>
        </div>
        <aside class="notes">
          <ul>
            <li>Bytes, not chars; do not print</li>
            <li>random_int() is inclusive.</li>
            <li>Throws exceptions if can't run.</li>
          </ul>
        </aside>
      </section>
      <section>
        <p class="bigtext">If you're not using these functions for security...</p>
        <ul class="fragment">
          <li>password_hash() / password_verify()</li>
          <li>random_bytes()</li>
          <li>random_int()</li>
        </ul>
        <p id="security-wrong" class="fragment" data-classer="security-wrong" data-classer-class="bigdeal" style="margin-top: 1em;">You're Doing It Wrong!</p>
      </section>
      <section class="l-2up">
        <h2>BC Warning!</h2>
        <div>
          <p>Reserved function names</p>
          <ul>
            <li><code>random_bytes()</code></li>
            <li><code>random_int()</code></li>
          </ul>
        </div>
        <div><img src="assets/bc-mammoth.jpg" alt="BC Warning" data-credit="https://www.flickr.com/photos/sabeth718/3621132155" /></div>
      </section>
    </section>
    <section>
      <!-- Anonymous classes -->
      <section>
        <h1>#6</h1>
      </section>
      <section>
        <h2>Mocking is hard</h2>
         <pre class="font--24"><code class="php" data-trim>
$mock_repository = $this
  ->getMockBuilder(ThingieRepository::class)
  ->disableOriginalConstructor()
  ->getMock();

$obj1 = new Thingie();
$obj1->setVal('abc');

$obj2 = $this->getMockBuilder(Thingie::class)
  ->disableOriginalConstructor()
  ->getMock();
$obj1 ->method('getVal')->willReturn('def');

$map = [ [1, $obj1], [2, $obj2] ];

$mock_repository
  ->method('load')->will($this->returnValueMap($map));

$subject = new ClassUnderTest($mock_repository);
$this->assertTrue($subject->findThings());
         </code></pre>
        <aside class="notes">
          <ul>
            <li>Ugly mock DSL</li>
            <li>Dates from PHP 5.2 days or earlier</li>
            <li>What we really want is a custom class, but put the code where?</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Fakes are easy</h2>
         <pre class="font--24"><code class="php" data-trim>
$fake_repository = new class extends ThingieRepository {
  public function __construct() {}

  public function load($id) {
    switch ($id) {
      case 1:
        $obj1 = new Thingie();
        $obj1->setVal('abc');
        return $obj1;
      case 2:
        return new class extends Thingie {
          public function getVal() {
            return 'def';
          }
        };
    }
  }
};

$subject = new ClassUnderTest($fake_repository);
$this->assertTrue($subject->findThings());
         </code></pre>
        <aside class="notes">
          <ul>
            <li>Single-use class, define on instantiation</li>
            <li>Mostly useful for testing</li>
            <li>Can extend, implement, traits, pass type checks, NOT serialize</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>One-off dependencies</h2>
         <pre class="font--24"><code class="php" data-trim>
new Service(new class implements LoggerInterface {
  use LoggerTrait;

  public function log($message) {
    print $message . PHP_EOL;
  }
});
         </code></pre>
        <aside class="notes">
          <ul>
            <li>Also useful for debugging.</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Constructors, too</h2>
         <pre class="font--24"><code class="php" data-trim>
new class($logger) implements ServiceInterface {
  public function __construct(LoggerInterface $logger) {
    $this->logger = $logger;
  }

  public function doServiceStuff() { }
};
         </code></pre>
        <aside class="notes">
          <ul>
            <li>As with anon functions, don't get too carried away.</li>
          </ul>
        </aside>
      </section>
    </section>
    <section>
      <!-- Engine exceptions / Errors -->
      <section>
        <h1>#7</h1>
      </section>
      <section>
        <p class="bigtext">Fatal errors suck</p>
        <p class="fragment bigtext">Recoverable errors&hellip; aren't</p>
        <aside class="notes">
          <ul>
            <li>No cleanup</li>
            <li>No finally, no destructors</li>
            <li>No context in error handler</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>PHP 5</h2>
        <pre class="font--24"><code class="php" data-trim>
function doStuff(Request $r) {
  // ...
}

$u = new User();

doStuff($u);
        </code></pre>
        <p class="fragment"><code>Catchable fatal error: Argument 1 passed to doStuff() must be an instance of Request,<br />instance of User given</code></p>
        <aside class="notes">
          <ul>
            <li>Why catchable if I can't catch?</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>PHP 7</h2>
        <pre class="font--24"><code class="php" data-trim>
function doStuff(Request $r) {
  // ...
}

$u = new User();

try {
  doStuff($u);
}
catch (\TypeError $e) {
  print "Wrong variable type, dummy." . PHP_EOL;
}
        </code></pre>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
try {
  include 'buggy_file.php';
}
catch (\ParseError $e) {
  $logger->error("That file is buggy!");
}
        </code></pre>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
try {
  nonexistant_function();
}
catch (\Error $e) {
  print "The error was " . $e->getMessage();
}
        </code></pre>
      </section>
      <section>
        <div><img src="assets/throwable-hierarchy.svg" alt="Throwable is at the root of all Errors and Exceptions" data-credit="Larry Garfield" /></div>
        <p class="fragment" style="text-decoration: line-through">E_FATAL, E_RECOVERABLE_ERROR, E_PARSE, E_COMPILE_ERROR</p>
      </section>
      <section>
        <p class="bigtext">Exceptions: The user screwed up</p>
        <p class="bigtext">Errors: The coder screwed up</p>
        <aside class="notes">
          <ul>
            <li>Really only useful for high-level log/cleanup</li>
            <li>Unlikely you can continue anyway.</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>BC Warning!</h2>
        <img src="assets/bc-lego-caveman.jpg" alt="BC Warning" width="70%" data-credit="https://www.flickr.com/photos/pasukaru76/5964727769" />
        <p>New reserved class names</p>
        <p>Global exception handler</p>
      </section>
      <section>
        <h3>PHP 5</h3>
        <pre class="font--24"><code class="php" data-trim>
set_exception_handler(function(\Exception $e) {
  // ...
});
        </code></pre>
        <div class="fragment">
          <h3>PHP 7</h3>
          <pre class="font--24"><code class="php" data-trim>
set_exception_handler(function(\Throwable $e) {
  // ...
});
          </code></pre>
        </div>
        <div class="fragment">
          <h3>PHP 5 &amp; 7</h3>
          <pre class="font--24"><code class="php" data-trim>
set_exception_handler(function($e) {
  // ...
});
          </code></pre>
        </div>
      </section>
    </section>
    <section>
      <!-- Expectations -->
      <section>
        <h1>#8</h1>
      </section>
      <section>
        <p class="bigtext">Assertions suck</p>
        <pre class="fragment font--20"><code class="php" data-trim>
function doStuff(array $def) {
  assert(isset($def['key']) && isset($def['value']), 'Invalid def');
  // ...
}
        </code></pre>
        <div class="fragment" style="margin-top: 1em;">
          <pre class="font--20"><code class="php" data-trim>
function doStuff(array $def) {
  assert('isset($def[\'key\']) && isset($def[\'value\'])', 'Invalid def');
  // ...
}
          </code></pre>
        </div>
        <aside class="notes">
          <ul>
            <li>Only in development, disable on prod</li>
            <li>assert() is func, code always executes</li>
            <li>String gets eval()ed.</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>PHP 7: Expectations</h2>
        <pre class="font--18"><code class="php" data-trim>
ini_set('assert.exception', 1);
ini_set('zend.assertions', 1);

class InvalidDef extends AssertionError {}

function doStuff(array $def) {
  assert(isset($def['key']) && isset($def['value']), new InvalidDef('Invalid def'));
  // ...
}
        </code></pre>
        <p class="fragment bigtext">Assertions are actually not-broken!</p>
        <aside class="notes">
          <ul>
            <li>assert() now language construct</li>
            <li>Smart now.</li>
            <li>Note AssertionError, not AssertionException</li>
            <li>Still disable in production</li>
          </ul>
        </aside>
      </section>
    </section>
    <section>
      <!-- Generators -->
      <section>
        <h1>#9</h1>
      </section>
      <section>
        <h3>You're not still doing iterators<br/>the hard way, are you?</h3>
      </section>
      <section>
        <pre class="font--18"><code class="php" data-trim>
class RemoteSource implements Iterator {
  protected $key;

  protected $current;

  protected $client;

  public function __construct(Client $client) {
    $this->client = $client;
    $this->key = 0;
  }

  public function current() {
    return $this->current;
  }

  public function next() {
    $this->current = $this->client->get('http://api.com/entry/' . $this->key);
    $this->key++;
  }

  public function key() {
    return $this->key;
  }

  public function valid() {
    return (bool)$this->current;
  }

  public function rewind() {
    throw new Exception();
  }
}
        </code></pre>
      </section>
      <section>
        <pre class="font--24"><code class="php" data-trim>
$result = $db->query(...);

$iterator = new AppendIterator();
$iterator->append(new RemoteSource($client));
$iterator->append($result);

foreach ($iterator as $item) {
  // Do something.
}
        </code></pre>
      </section>
      <section>
        <h3>In PHP 7...</h3>
        <pre class="font--20"><code class="php" data-trim>
function getRemoteValues($client) {
  $key = 0;
  while ($val = $client->get('http://api.com/entry/' . $key++)) {
    yield $val;
  }
}

function getLocalValues() {
  foreach (db()->query(...) as $record) {
    yield $record;
  }
}

function getValues($client) {
  // This is the new part.
  yield from getRemoteValues($client);
  yield from getLocalValues();
  return 'done';
}

$values = getValues($client);
foreach ($values as $item) {
  // Do stuff
}
print $val->getReturn() . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>"yield from" useful for aggregating lists</li>
            <li>Mostly for coroutines (Icicle.io)</li>
          </ul>
        </aside>
      </section>
    </section>
    <section>
      <!-- Uniform variable syntax -->
      <section>
        <h1>#10</h1>
      </section>
      <section>
        <h2>What does this do?</h2>
        <pre class="fragment font--24"><code class="php" data-trim>
$$foo['bar']['baz']
        </code></pre>
        <pre class="fragment font--24"><code class="php" data-trim>
$foo->$bar['baz']
        </code></pre>
        <pre class="fragment font--24"><code class="php" data-trim>
$foo->$bar['baz']()
        </code></pre>
        <pre class="fragment font--24"><code class="php" data-trim>
Foo::$bar['baz']()
        </code></pre>
        <pre class="fragment font--24"><code class="php" data-trim>
Foo::$bar[1][2][3]()
        </code></pre>
        <aside class="notes">
          <ul>
            <li>First: ${$foo['bar']['baz']}</li>
            <li>Second:$foo->{$bar['baz']} </li>
            <li>Third: $foo->{$bar['baz']}()</li>
            <li>Fourth: Foo::{$bar['baz']}() </li>
            <li>Fifth: Calls static method $bar[1][2][3] of Foo</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Uniform variable syntax</h2>
        <p class="bigtext fragment">Always Left-To-Right</p>
        <aside class="notes">
          <ul>
            <li>Makes parser easier</li>
            <li>More predictable</li>
            <li>Adds some nifty new options</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>It's logical</h2>
        <pre class="font--24"><code class="php" data-trim>
$foo()['bar']()
[$obj1, $obj2][0]->prop
getStr(){0}
$foo['bar']::$baz
$foo->bar()::baz()
$foo()()
        </code></pre>
        <pre class="fragment font--24"><code class="php" data-trim>
(...)['foo']
(...)->foo
(...)->foo()
(...)()

(function() { ... })()
($obj->closure)()
        </code></pre>
      </section>
      <section>
        <h2>BC Break</h2>
        <img src="assets/bc-flintstones.jpg" alt="BC Break" data-credit="hhttp://animatedviews.com/wp-content/uploads/2010/09/flintstone50.jpg" />
        <p>Complex cases change meaning</p>
        <p class="fragment">When in doubt, use () or {}</p>
      </section>
    </section>
    <section>
      <!-- Performance (PHP goes to 11) -->
      <section>
        <img src="assets/goes-to-11.jpg" alt="11" data-credit="https://twitter.com/it_goes_to_11" />
      </section>
      <section data-background="assets/cheetah-running.jpg" data-credit="https://www.flickr.com/photos/martin_heigan/4544138976/">
      </section>
      <section data-background="assets/pocket-protector.jpg">
        <aside class="notes">
          <ul>
            <li>The reasons are nerdy</li>
            <li>C-level optimizations, API changes, struct packing, etc.</li>
          </ul>
        </aside>
      </section>
      <section>
        <img src="assets/benchmarks/drupal.png" width="100%" data-credit="http://talks.php.net/fluent15" />
        <p>Credit: <a href="http://talks.php.net/fluent15">Rasmus Lerdorf</a></p>
      </section>
      <section>
        <img src="assets/benchmarks/wordpress.png" width="100%" data-credit="http://talks.php.net/fluent15" />
        <p>Credit: <a href="http://talks.php.net/fluent15">Rasmus Lerdorf</a></p>
        <aside class="notes">
          <ul>
            <li>Note, Drupal 8 still way better than Wordpress. :-)</li>
          </ul>
        </aside>
      </section>
      <section>
        <img src="assets/benchmarks/phpbb.png" width="100%" data-credit="http://talks.php.net/fluent15" />
        <p>Credit: <a href="http://talks.php.net/fluent15">Rasmus Lerdorf</a></p>
      </section>
      <section>
        <img src="assets/benchmarks/mediawiki.png" width="100%" data-credit="http://talks.php.net/fluent15" />
        <p>Credit: <a href="http://talks.php.net/fluent15">Rasmus Lerdorf</a></p>
        <aside class="notes">
          <ul>
            <li>Sometimes PHP 7 faster, sometimes HHVM faster</li>
            <li>Both blow PHP 5.6 out of the water.</li>
          </ul>
        </aside>
      </section>
    </section>
    <section>
      <section>
        <p class="bigtext"><q>But I'm scared of .0 releases!</q></p>
      </section>
      <section>
        <ul class="project-list">
          <li><img src="assets/drupal-8-logo.svg" alt="Drupal 8" /></li>
          <li><img src="assets/symfony-logo-vertical.svg" alt="Symfony2 and 3" /></li>
          <li><img src="assets/zf2-logo.svg" alt="Zend Framework 2 and 3" /></li>
          <li><img src="assets/laravel-l-slant.png" alt="Larvel" /></li>
          <li><img src="assets/yii-logo.png" alt="Yii framework" /></li>
          <li><img src="assets/magento-logo.png" alt="Magento" /></li>
          <li><img src="assets/slim-logo.png" alt="Slim" /></li>
          <li><img src="assets/wordpress-logo-stacked.png" alt="Wordpress" /></li>
          <li><img src="assets/cake-logo.png" alt="Cake PHP 3" /></li>
          <li><img src="assets/doctrineorm.jpg" alt="Doctrine" /></li>
          <li><img src="assets/phpmyadmin-logo.png" alt="phpMyAdmin" /></li>
        </ul>
        <aside class="notes">
          <ul>
            <li>Last minute delay in PHP 7 release due to engine bugs Drupal 8 found in testing.</li>
          </ul>
        </aside>
      </section>
      <section>
        <p class="bigtext"><a href="http://phpversions.info/">http://phpversions.info/</a></p>
        <p class="bigtext">PHP 7-ready hosts: <span class="fragment" data-countup="1" data-countup-step="1">48</span> <span class="fragment"> and counting</span></p>
        <p class="bigtext fragment">(Yes, <a href="http://www.platform.sh/">Platform.sh</a> is one of them!)</p>
      </section>
    </section>
    <section>
      <img src="assets/php7-logo.svg" alt="PHP 7" data-credit="http://www.cowburn.info/2015/06/18/php7-logo/" />
    </section>

    <div style="display:none">
      Problem-solution style.

      Scalar types
      Return types

      Spaceship operator
      Null coalesce
      CSPRING

      Anonymous classes
      Errors
      Expectations (assertions that work)

      Generator improvements
      Uniform variable syntax

      Speed
    </div>

    <section id="final">
      <h2>Larry Garfield</h2>
      <p>Director of Runtimes and Integrations <a href="http://www.platform.sh/">Platform.sh</a></p>
      <p>Continuous Deployment Cloud Hosting</p>
      <p>Stalk us at <a href="http://twitter.com/Platformsh">@PlatformSH</a></p>

      <p style="margin-top: 2em"><small>Thanks to <a href="http://www.palantir.net/">Palantir.net</a> for helping develop these slides</small></p>
    </section>

  </div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

  // Full list of configuration options available at:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,

    transition: 'slide', // none/fade/slide/convex/concave/zoom

    // Optional reveal.js plugins
    dependencies: [
      { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'plugin/zoom-js/zoom.js', async: true },
      { src: 'plugin/notes/notes.js', async: true }
    ]
  });

</script>

</body>
</html>
